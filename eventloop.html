
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta http-equiv="origin-trial" content="Ao0EZghG8JcG304S/1zuHSvAvxhLeJWxSufhdiJ8CApanxdj5ZJkIuBsex5MktcLZKf8M8pFioI1UvTHQjtN+g0AAABleyJvcmlnaW4iOiJodHRwczovL3JhbmRvbS5uZGV2LnRrOjQ0MyIsImZlYXR1cmUiOiJVbnJlc3RyaWN0ZWRTaGFyZWRBcnJheUJ1ZmZlciIsImV4cGlyeSI6MTY1ODg3OTk5OX0=">
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/1.33.1/plotly.min.js"
      integrity="sha512-V0j9LhrK9IMNdFYZqh+IqU4cjo7wdxyHNyH+L0td4HryBuZ7Oq6QxP2/CWr6TituX31+gv5PnolvERuTbz8UNA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <style>
      body {
        background-color: #444444;
        color: white;
      }
      @media screen and (prefers-color-scheme: light) {
        body {
          background-color: white;
          color: black;
        }
      }
    </style>
  </head>
  <body>
    <iframe id="frame"></iframe>
    <iframe id="test"></iframe>
    <div class="navbar"><h1>Iframe monitor</h1></div>
    <label for="target">Target </label
    ><input type="text" id="target" /><br />

    <div class="wrapper">
      <div id="chart"></div>
      <script>
        target.onchange = () => {
          test.src = target.value;
        }
        
        // Define a function to be ran inside a WebWorker
        function timer() {
          self.onmessage = function(event) {
            const sharedBuffer = event.data;
            const sharedArray = new Uint32Array(sharedBuffer);

            // Infinitely increase the uint32 number
            while (true) Atomics.add(sharedArray, 0, 1);
          };
        }

        const worker = new Worker(
          URL.createObjectURL(
            new Blob([`(${timer})()`], {
              type: "text/javascript"
            })
          )
        );

        // Create a Shared buffer between the WebWorker and a document
        const sharedBuffer = new SharedArrayBuffer(
          Uint32Array.BYTES_PER_ELEMENT
        );
        const sharedArray = new Uint32Array(sharedBuffer);
        worker.postMessage(sharedBuffer);
        
        let start;
        
        target.onchange = () => {
          frame.contentWindow.location = target.value;
        }
        
        setInterval(() => {
          frame.contentWindow.location = target.value;
        }, 1000);
        
        frame.onload = () => {
          let time = Atomics.load(sharedArray, 0);
          if (start) {
            Plotly.extendTraces("chart", { y: [[time - start]] }, [0]);
            cnt++;
            if (cnt > 500) {
              Plotly.relayout("chart", {
                xaxis: {
                  range: [cnt - 500, cnt]
                }
              });
            }
          };
          start = Atomics.load(sharedArray, 0);
          frame.contentWindow.location = target.value;
        }

        Plotly.plot("chart", [
          {
            y: [],
            type: "line"
          }
        ]);

        var cnt = 0;
      </script>
    </div>
  </body>
</html>
