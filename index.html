<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="object-src 'none'; base-uri 'none'; require-trusted-types-for 'script';" />
    <title>Celestial Canvas</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            color: white;
            cursor: none; /* Hide the default cursor */
        }

        body {
            background-size: 400% 400%;
            animation: gradientAnimation 25s ease infinite;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #cursor-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0) 60%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease-out;
        }
        
        #cursor-glow.active {
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 50%);
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2;
        }

        #instruction-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.7);
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            animation: fade-in-out 6s ease-in-out forwards;
        }

        @keyframes fade-in-out {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

    </style>
</head>
<body>
    <div id="instruction-text">Click and hold to form a comet</div>
    <div id="cursor-glow"></div>
    <div id="particles-js"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script>
        const particlesConfig = { "particles": { "number": { "value": 150, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle", "polygon": { "nb_sides": 5 }, "star": { "nb_sides": 5 } }, "opacity": { "value": 0.5, "random": true }, "size": { "value": 2, "random": true }, "line_linked": { "enable": false, "color": "#ffffff" }, "move": { "enable": true, "speed": 4, "direction": "none", "out_mode": "out" } }, "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "bubble" }, "resize": true }, "modes": { "grab": { "distance": 200, "line_linked": { "opacity": 1 } }, "bubble": { "distance": 200, "size": 8, "duration": 2, "opacity": 1 }, "repulse": { "distance": 150, "duration": 0.4 } } }, "retina_detect": true };

        function getRandomColor() { const h = Math.floor(Math.random() * 360); const s = Math.floor(Math.random() * 20) + 75; const l = Math.floor(Math.random() * 20) + 50; return `hsl(${h}, ${s}%, ${l}%)`; }
        function hslToHex(h, s, l) { l /= 100; const a = s * Math.min(l, 1 - l) / 100; const f = n => { const k = (n + h / 30) % 12; const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1); return Math.round(255 * color).toString(16).padStart(2, '0'); }; return `#${f(0)}${f(8)}${f(4)}`; }
        function setRandomGradient() { const angle = Math.floor(Math.random() * 360); document.body.style.background = `linear-gradient(${angle}deg, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()})`; document.body.style.backgroundSize = '400% 400%'; }

        document.addEventListener('DOMContentLoaded', () => {
            const cursorGlow = document.getElementById('cursor-glow');
            let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
            let isCometActive = false;
            let initialSpeed = 4; // To store the randomized speed

            const randomizeScene = (pJS) => {
                setRandomGradient();

                const particleColor = hslToHex(Math.random() * 360, 70 + Math.random() * 30, 60 + Math.random() * 30);
                pJS.particles.color.value = particleColor;
                pJS.particles.line_linked.color = particleColor;

                pJS.particles.number.value = Math.floor(Math.random() * 200) + 75;
                pJS.particles.size.value = Number(((Math.random() * 4) + 1).toFixed(1));
                pJS.particles.opacity.value = Number((Math.random() * 0.6 + 0.2).toFixed(2));
                
                initialSpeed = Number(((Math.random() * 5) + 1).toFixed(1));
                pJS.particles.move.speed = initialSpeed;

                const shapes = ['circle', 'edge', 'triangle', 'polygon', 'star'];
                pJS.particles.shape.type = shapes[Math.floor(Math.random() * shapes.length)];
                
                if (['polygon', 'star'].includes(pJS.particles.shape.type)) {
                    const sides = Math.floor(Math.random() * 6) + 5;
                    pJS.particles.shape.polygon.nb_sides = sides;
                    if(pJS.particles.shape.star) pJS.particles.shape.star.nb_sides = sides;
                }

                pJS.particles.line_linked.enable = Math.random() < 0.4;
                
                const hoverModes = ['bubble', 'repulse', 'grab'];
                pJS.interactivity.events.onhover.enable = true;
                pJS.interactivity.events.onhover.mode = hoverModes[Math.floor(Math.random() * hoverModes.length)];

                pJS.fn.particlesRefresh();
            };

            particlesJS('particles-js', particlesConfig);
            const pJS = window.pJSDom[0].pJS;
            randomizeScene(pJS);

            const update = () => {
                if (isCometActive) {
                    for(const particle of pJS.particles.array) {
                        const dx = mouse.x - particle.x;
                        const dy = mouse.y - particle.y;
                        particle.vx = dx / 20; // A smoother, less aggressive pull
                        particle.vy = dy / 20;
                    }
                }
                pJS.fn.particlesDraw();
                requestAnimationFrame(update);
            };
            requestAnimationFrame(update);

            window.addEventListener('mousemove', e => {
                mouse.x = e.clientX; mouse.y = e.clientY;
                cursorGlow.style.left = `${e.clientX}px`;
                cursorGlow.style.top = `${e.clientY}px`;
            });

            window.addEventListener('mousedown', () => {
                isCometActive = true;
                pJS.particles.move.speed = 0;
                pJS.interactivity.events.onhover.enable = false;
                cursorGlow.classList.add('active');
            });

            window.addEventListener('mouseup', () => {
                isCometActive = false;
                cursorGlow.classList.remove('active');
                
                for(const particle of pJS.particles.array) {
                    const angle = Math.random() * 2 * Math.PI;
                    const speed = Math.random() * 25 + 5;
                    particle.vx = Math.cos(angle) * speed;
                    particle.vy = Math.sin(angle) * speed;
                }
                
                setTimeout(() => randomizeScene(pJS), 1800);
            });
        });
    </script>
</body>
</html>
