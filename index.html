<html>
<head>
<title>RANDOM</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.1.0/webcomponents-loader.js" integrity="sha384-HkipI22XmPfYh/sTVk+3rOcb4Gtfhu5oMP6n/ksrA/VA54SFDBrQcqUfy7+9j5CR" crossorigin="anonymous"></script>
<script src="flickrRandom.js"></script>
<style>
body {
	background: #191919;
	background-size: cover;
}
ken-burns-carousel {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}
</style>
</head>
<body>
<ken-burns-carousel id="bg" fade-duration="2000" slide-duration="5000" animation-direction="normal"></ken-burns-carousel>
<script>
let params = (new URL(document.location)).searchParams;

// Unsplash Start
unsplash = params.has('unsplash');
subject = encodeURI(params.get('subject'));
if (params.has('subject')) {
    end = "featured/?" + subject;
} else {
    end = 'random';
}
document.body.style.backgroundImage = 'url(https://source.unsplash.com/' + end + ')'

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
async function imagemgr() {
    while (true) {
        await getimages(1).then(urls => document.getElementById('bg').images = urls);
    }
}
async function getimages(amount) {
    var images = [];
    for (i = 0; i < amount; i++) {
        await fetch('https://source.unsplash.com/' + end).then(img => images.push(img.url));
        await sleep(2000);
    }
    return images
}
// Unsplash End

if (!unsplash) InitFlickrRandom(subject);
window.addEventListener('WebComponentsReady', function(e) {
    const kenBurnsCarousel = document.createElement('script');
    kenBurnsCarousel.src = 'ken-burns-carousel.min.js';
    document.head.appendChild(kenBurnsCarousel);
    kenBurnsCarousel.onload = () => {
        if (unsplash) {
            imagemgr(); // Unsplash
        } else {
            window.addEventListener("onFlickrImage", function(event) { // Flickr
                document.getElementById('bg').images = [event.detail.url];
            });
        }
    }
});
</script>
</body>
</html>
