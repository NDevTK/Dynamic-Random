<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="object-src 'none'; base-uri 'none'; require-trusted-types-for 'script';" />
    <title>Celestial Canvas</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            color: white;
            cursor: none;
        }

        body {
            background-size: 400% 400%;
            animation: gradientAnimation 25s ease infinite;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #cursor-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0) 60%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease-out;
        }
        
        #cursor-glow.active {
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 50%);
        }
        
        #cursor-glow.repulse {
             background: radial-gradient(circle, rgba(200, 0, 0, 0.15) 0%, rgba(255, 255, 255, 0) 50%);
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2;
        }
    </style>
</head>
<body>
    <div id="cursor-glow"></div>
    <div id="particles-js"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script>
        const baseConfig = { "particles": { "number": { "value": 150, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle", "polygon": { "nb_sides": 5 }, "star": { "nb_sides": 5 } }, "opacity": { "value": 0.5, "random": true }, "size": { "value": 2, "random": true }, "line_linked": { "enable": false, "color": "#ffffff", "distance": 150 }, "move": { "enable": true, "speed": 4, "direction": "none", "out_mode": "out" } }, "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "bubble" }, "resize": true }, "modes": { "grab": { "distance": 200, "line_linked": { "opacity": 1 } }, "bubble": { "distance": 200, "size": 8, "duration": 2, "opacity": 1 }, "repulse": { "distance": 150, "duration": 0.4 } } }, "retina_detect": true };

        function getRandomColor() { const h = Math.floor(Math.random() * 360); const s = Math.floor(Math.random() * 20) + 75; const l = Math.floor(Math.random() * 20) + 50; return `hsl(${h}, ${s}%, ${l}%)`; }
        function hslToHex(h, s, l) { l /= 100; const a = s * Math.min(l, 1 - l) / 100; const f = n => { const k = (n + h / 30) % 12; const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1); return Math.round(255 * color).toString(16).padStart(2, '0'); }; return `#${f(0)}${f(8)}${f(4)}`; }
        function setRandomGradient() { const angle = Math.floor(Math.random() * 360); document.body.style.background = `linear-gradient(${angle}deg, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()})`; document.body.style.backgroundSize = '400% 400%'; }

        document.addEventListener('DOMContentLoaded', () => {
            const cursorGlow = document.getElementById('cursor-glow');
            const friction = 0.98;
            let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2, vx: 0, vy: 0 };
            let isMouseDown = false;
            let initialSpeed = 4;
            let activeMouseMode = 'comet';

            const mouseModes = ['comet', 'repulsor', 'gravityWell', 'creator'];

            const generateRandomScene = (pJS) => {
                setRandomGradient();
                const particleColor = hslToHex(Math.random() * 360, 70 + Math.random() * 30, 60 + Math.random() * 30);
                pJS.particles.color.value = particleColor; pJS.particles.line_linked.color = particleColor;
                pJS.particles.number.value = Math.floor(Math.random() * 150) + 75;
                pJS.particles.size.value = Number(((Math.random() * 4) + 1).toFixed(1));
                pJS.particles.opacity.value = Number((Math.random() * 0.6 + 0.2).toFixed(2));
                const shapes = ['circle', 'edge', 'triangle', 'polygon', 'star'];
                pJS.particles.shape.type = shapes[Math.floor(Math.random() * shapes.length)];
                if (['polygon', 'star'].includes(pJS.particles.shape.type)) { pJS.particles.shape.polygon.nb_sides = Math.floor(Math.random() * 6) + 5; }
                
                const physicsChoice = Math.random();
                if (physicsChoice < 0.33) { pJS.particles.move.direction = ["top", "bottom", "left", "right"][Math.floor(Math.random() * 4)]; pJS.particles.move.out_mode = "out"; initialSpeed = Math.random() * 2 + 0.5;
                } else if (physicsChoice < 0.66) { pJS.particles.move.direction = "none"; pJS.particles.move.out_mode = "bounce"; initialSpeed = Math.random() * 4 + 2;
                } else { pJS.particles.move.direction = "none"; pJS.particles.move.out_mode = "out"; initialSpeed = Math.random() * 5 + 1; }
                pJS.particles.move.speed = initialSpeed;

                const isLinked = Math.random() < 0.3;
                pJS.particles.line_linked.enable = isLinked;
                pJS.interactivity.events.onhover.enable = true;
                if (isLinked) { pJS.interactivity.events.onhover.mode = 'grab'; } else { pJS.interactivity.events.onhover.mode = ['bubble', 'repulse'][Math.floor(Math.random() * 2)]; }
                
                // --- Choose the user's power for this session ---
                activeMouseMode = mouseModes[Math.floor(Math.random() * mouseModes.length)];

                pJS.fn.particlesRefresh();
            };

            particlesJS('particles-js', baseConfig);
            const pJS = window.pJSDom[0].pJS;
            generateRandomScene(pJS);

            const update = () => {
                for(const particle of pJS.particles.array) {
                    if (isMouseDown) {
                        const dx = mouse.x - particle.x;
                        const dy = mouse.y - particle.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);

                        switch(activeMouseMode) {
                            case 'comet':
                                particle.vx += (dx * 0.05) - (dy * 0.01);
                                particle.vy += (dy * 0.05) + (dx * 0.01);
                                break;
                            case 'repulsor':
                                const force = -100 / (dist * dist);
                                if (dist < 150) {
                                    particle.vx += dx * force;
                                    particle.vy += dy * force;
                                }
                                break;
                            case 'gravityWell':
                                const orbitDist = 100;
                                const pullForce = 0.05 * (dist - orbitDist) / orbitDist;
                                particle.vx += dx * pullForce - dy * 0.01;
                                particle.vy += dy * pullForce + dx * 0.01;
                                break;
                            case 'creator':
                                if(Math.random() > 0.9) { // Add particles intermittently
                                    pJS.fn.modes.pushParticles(1, mouse);
                                }
                                break;
                        }
                    }
                    particle.vx *= friction;
                    particle.vy *= friction;
                }
                pJS.fn.particlesDraw();
                requestAnimationFrame(update);
            };
            requestAnimationFrame(update);

            window.addEventListener('mousemove', e => {
                mouse.vx = e.clientX - mouse.x; mouse.vy = e.clientY - mouse.y;
                mouse.x = e.clientX; mouse.y = e.clientY;
                cursorGlow.style.left = `${e.clientX}px`; cursorGlow.style.top = `${e.clientY}px`;
            });

            window.addEventListener('mousedown', () => {
                isMouseDown = true;
                pJS.particles.move.speed = 0;
                pJS.interactivity.events.onhover.enable = false;
                cursorGlow.classList.add('active');
                if (activeMouseMode === 'repulsor') {
                    cursorGlow.classList.add('repulse');
                }
            });

            window.addEventListener('mouseup', () => {
                isMouseDown = false;
                cursorGlow.classList.remove('active');
                cursorGlow.classList.remove('repulse');
                pJS.particles.move.speed = initialSpeed;
                pJS.interactivity.events.onhover.enable = true;
                
                if (activeMouseMode === 'comet' || activeMouseMode === 'repulsor') {
                    const mouseSpeed = Math.min(30, Math.sqrt(mouse.vx * mouse.vx + mouse.vy * mouse.vy));
                    for(const particle of pJS.particles.array) {
                        const angle = Math.random() * 2 * Math.PI;
                        const explosionSpeed = Math.random() * 20 + mouseSpeed;
                        particle.vx = (Math.cos(angle) * explosionSpeed) + (mouse.vx * 0.5);
                        particle.vy = (Math.sin(angle) * explosionSpeed) + (mouse.vy * 0.5);
                    }
                }
            });
        });
    </script>
</body>
</html>
