<html>
<head>
    <title>RANDOM</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.1.0/webcomponents-loader.js"></script>

    <style>
        body {
            background: #fafafa;
        }
        ken-burns-carousel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
        }
    </style>
</head>
<body>
<ken-burns-carousel id="bg" fade-duration="2000" slide-duration="5000" animation-direction="normal"></ken-burns-carousel>
<script>
function escapeHtml(text) {
  var map = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  };

  return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}

let params = (new URL(document.location)).searchParams;
if(params.has('subject')){
end = "featured/?" + escapeHtml(params.get('subject'));

}else{
end = 'random';
}
 document.body.style.background = 'url(https://source.unsplash.com/'+end+') no-repeat center center'
    
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
async function imagemgr() {
    while (true) {
        await getimages(2).then(urls => document.getElementById('bg').images = urls);
    }
}
async function getimages(amount) {
    var images = [];
    for (i = 0; i < amount; i++) {
        await fetch('https://source.unsplash.com/'+end).then(img => images.push(img.url));
        await sleep(2000);
    }
    return images
}
window.addEventListener('WebComponentsReady', function(e) {
    const kenBurnsCarousel = document.createElement('script');
    kenBurnsCarousel.src = 'ken-burns-carousel.min.js';
    document.head.appendChild(kenBurnsCarousel);
    kenBurnsCarousel.onload = () => {
        imagemgr();
    }
});
</script>
</body>
</html>
