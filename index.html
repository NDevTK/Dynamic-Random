<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="object-src 'none'; base-uri 'none'; require-trusted-types-for 'script';" />
    <title>Celestial Canvas</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            color: white;
            cursor: none;
        }

        body {
            background-size: 400% 400%;
            animation: gradientAnimation 25s ease infinite;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #cursor-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0) 60%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease-out;
        }

        #cursor-glow.active {
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0) 50%);
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2;
        }

        #instruction-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5em;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.7);
            pointer-events: none;
            z-index: 5;
            opacity: 0;
            animation: fade-in-out 6s ease-in-out forwards;
        }

        @keyframes fade-in-out {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

    </style>
</head>
<body>
    <div id="instruction-text">Click and hold to create a comet</div>
    <div id="cursor-glow"></div>
    <div id="particles-js"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script>
        const particlesConfig = { "particles": { "number": { "value": 200, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.8, "random": true }, "size": { "value": 2.5, "random": true }, "line_linked": { "enable": false }, "move": { "enable": true, "speed": 1, "direction": "none", "out_mode": "out" } }, "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true } }, "retina_detect": true };

        function getRandomColor() { const h = Math.floor(Math.random() * 360); const s = Math.floor(Math.random() * 20) + 75; const l = Math.floor(Math.random() * 20) + 50; return `hsl(${h}, ${s}%, ${l}%)`; }
        function setRandomGradient() { const angle = Math.floor(Math.random() * 360); document.body.style.background = `linear-gradient(${angle}deg, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()})`; document.body.style.backgroundSize = '400% 400%'; }

        document.addEventListener('DOMContentLoaded', () => {
            const cursorGlow = document.getElementById('cursor-glow');
            let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
            let isCometActive = false;

            // --- New: Assign Depth to Each Particle ---
            const assignParallaxDepth = (pJS) => {
                for(const particle of pJS.particles.array) {
                    // Assign a depth between 0.1 (far) and 1.0 (close)
                    particle.depth = Math.random() * 0.9 + 0.1;
                    // Store original values
                    particle.originalSize = particle.radius;
                    particle.originalOpacity = particle.opacity_bubble;
                    // Scale size and opacity based on depth
                    particle.radius = particle.originalSize * particle.depth;
                    particle.opacity_bubble = particle.originalOpacity * particle.depth;
                }
            };

            const randomizeScene = (pJS) => {
                setRandomGradient();
                pJS.particles.color.value = `#${((1<<24)*Math.random()|0).toString(16).padStart(6,'0')}`;
                pJS.particles.number.value = Math.floor(Math.random() * 150) + 150; // 150-300 particles
                pJS.particles.move.speed = Number(((Math.random() * 2) + 0.5).toFixed(1)); // Slow base speed
                
                pJS.fn.particlesRefresh();
                assignParallaxDepth(pJS); // Assign depth after settings are refreshed
            };

            // --- INITIALIZE ---
            particlesJS('particles-js', particlesConfig);
            const pJS = window.pJSDom[0].pJS;
            randomizeScene(pJS);

            // --- Main Animation Loop ---
            const update = () => {
                if (isCometActive) {
                    for(const particle of pJS.particles.array) {
                        const dx = mouse.x - particle.x;
                        const dy = mouse.y - particle.y;
                        
                        // --- New: Parallax-aware attraction ---
                        // The pull strength is now proportional to the particle's depth
                        const force = (particle.depth * 4) + 1; // Base force + depth multiplier
                        particle.vx += dx / (1000 / force);
                        particle.vy += dy / (1000 / force);
                    }
                }
                
                pJS.fn.particlesDraw();
                requestAnimationFrame(update);
            };
            requestAnimationFrame(update);


            // --- Event Listeners ---
            window.addEventListener('mousemove', e => {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
                cursorGlow.style.left = `${e.clientX}px`;
                cursorGlow.style.top = `${e.clientY}px`;
            });

            window.addEventListener('mousedown', () => {
                isCometActive = true;
                pJS.particles.move.enable = false; // Disable default movement for full control
                cursorGlow.classList.add('active');
            });

            window.addEventListener('mouseup', () => {
                isCometActive = false;
                pJS.particles.move.enable = true; // Re-enable default movement
                cursorGlow.classList.remove('active');
                
                // --- New: Parallax-aware supernova ---
                for(const particle of pJS.particles.array) {
                    const angle = Math.random() * 2 * Math.PI;
                    // Closer particles get a much stronger push
                    const speed = (Math.random() * 15 + 5) * particle.depth;
                    particle.vx = Math.cos(angle) * speed;
                    particle.vy = Math.sin(angle) * speed;
                }
                
                setTimeout(() => randomizeScene(pJS), 2000);
            });
        });
    </script>
</body>
</html>
