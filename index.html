<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="object-src 'none'; base-uri 'none'; require-trusted-types-for 'script';" />
    <title>Celestial Canvas</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            color: white;
            cursor: none;
        }

        body {
            background-size: 400% 400%;
            animation: gradientAnimation 25s ease infinite;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #cursor-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 500px;
            height: 500px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.06) 0%, rgba(255, 255, 255, 0) 60%);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease-out;
        }
        
        #cursor-glow.active {
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, var(--glow-color, rgba(255, 255, 255, 0.15)) 0%, rgba(255, 255, 255, 0) 50%);
        }

        #particles-js {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2;
        }
    </style>
</head>
<body>
    <div id="cursor-glow"></div>
    <div id="particles-js"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
    <script>
        const baseConfig = { "particles": { "number": { "value": 150, "density": { "enable": true, "value_area": 800 } }, "color": { "value": "#ffffff" }, "shape": { "type": "circle", "polygon": { "nb_sides": 5 }, "image": { "src": "", "width": 100, "height": 100 } }, "opacity": { "value": 0.5, "random": false, "anim": { "enable": false, "speed": 1, "opacity_min": 0.1, "sync": false } }, "size": { "value": 3, "random": true, "anim": { "enable": false, "speed": 20, "size_min": 0.1, "sync": false } }, "line_linked": { "enable": false, "color": "#ffffff", "distance": 150 }, "move": { "enable": true, "speed": 4, "direction": "none", "out_mode": "out", "attract": { "enable": false, "rotateX": 600, "rotateY": 1200 } } }, "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": true, "mode": "bubble" }, "resize": true }, "modes": { "grab": { "distance": 200, "line_linked": { "opacity": 1 } }, "bubble": { "distance": 200, "size": 8, "duration": 2, "opacity": 1 }, "repulse": { "distance": 150, "duration": 0.4 } } }, "retina_detect": true };

        // --- NEW: Embedded Image Assets for Particles ---
        const imageAssets = {
            moon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="%23FFFFFF" d="M50,0 A50,50 0 1,0 50,100 A40,40 0 1,1 50,0 Z"/></svg>',
            starburst: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><polygon fill="%23FFFFFF" points="50,0 61,39 100,39 69,62 80,100 50,75 20,100 31,62 0,39 39,39"/></svg>',
            swirl: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path fill="none" stroke="%23FFFFFF" stroke-width="5" d="M50,50 C50,50 80,50 80,30 S60,10 40,20 S20,40 50,50 S80,60 70,80 S50,90 30,70 S50,50 50,50 Z"/></svg>'
        };

        function getRandomColor() { const h = Math.floor(Math.random() * 360); const s = Math.floor(Math.random() * 20) + 75; const l = Math.floor(Math.random() * 20) + 50; return `hsl(${h}, ${s}%, ${l}%)`; }
        function hslToHex(h, s, l) { l /= 100; const a = s * Math.min(l, 1 - l) / 100; const f = n => { const k = (n + h / 30) % 12; const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1); return Math.round(255 * color).toString(16).padStart(2, '0'); }; return `#${f(0)}${f(8)}${f(4)}`; }
        function setRandomGradient() { const angle = Math.floor(Math.random() * 360); document.body.style.background = `linear-gradient(${angle}deg, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()}, ${getRandomColor()})`; document.body.style.backgroundSize = '400% 400%'; }

        document.addEventListener('DOMContentLoaded', () => {
            const cursorGlow = document.getElementById('cursor-glow');
            const friction = 0.98;
            let mouse = { x: window.innerWidth / 2, y: window.innerHeight / 2, vx: 0, vy: 0 };
            let isMouseDown = false;
            let mouseDownTime = 0;
            let initialSpeed = 4;
            let powerProfile = {};

            const generateRandomPowerProfile = () => {
                powerProfile = { force: (Math.random() * 2) - 1, orbital: Math.random() * 0.2, stableOrbitDist: Math.random() < 0.2 ? Math.random() * 150 + 50 : 0, creatorChance: Math.random() < 0.1 ? Math.random() * 0.15 : 0 };
            };

            const generateRandomScene = (pJS) => {
                setRandomGradient();
                generateRandomPowerProfile();
                const particleColor = hslToHex(Math.random() * 360, 70 + Math.random() * 30, 60 + Math.random() * 30);
                pJS.particles.color.value = particleColor; pJS.particles.line_linked.color = particleColor;
                
                // --- Core Physics ---
                const physicsChoice = Math.random();
                if (physicsChoice < 0.33) { pJS.particles.move.direction = ["top", "bottom", "left", "right"][Math.floor(Math.random() * 4)]; pJS.particles.move.out_mode = "out"; initialSpeed = Math.random() * 2 + 0.5;
                } else if (physicsChoice < 0.66) { pJS.particles.move.direction = "none"; pJS.particles.move.out_mode = "bounce"; initialSpeed = Math.random() * 4 + 2;
                } else { pJS.particles.move.direction = "none"; pJS.particles.move.out_mode = "out"; initialSpeed = Math.random() * 5 + 1; }
                pJS.particles.move.speed = initialSpeed;
                pJS.particles.move.attract.enable = Math.random() < 0.25; // 25% chance of inter-particle gravity

                // --- Aesthetics & Shape ---
                const shapeChoice = Math.random();
                if (shapeChoice < 0.25) { pJS.particles.shape.type = 'image'; pJS.particles.shape.image.src = imageAssets.moon; pJS.particles.number.value = 50;
                } else if (shapeChoice < 0.5) { pJS.particles.shape.type = 'image'; pJS.particles.shape.image.src = imageAssets.starburst; pJS.particles.number.value = 75;
                } else if (shapeChoice < 0.75) { pJS.particles.shape.type = 'image'; pJS.particles.shape.image.src = imageAssets.swirl; pJS.particles.number.value = 100;
                } else { pJS.particles.shape.type = ['circle', 'edge', 'triangle', 'polygon', 'star']; pJS.particles.number.value = 150; }
                if (Array.isArray(pJS.particles.shape.type)) { pJS.particles.shape.polygon.nb_sides = Math.floor(Math.random() * 6) + 5; }

                pJS.particles.size.value = Number(((Math.random() * 4) + 1).toFixed(1));
                pJS.particles.opacity.value = Number((Math.random() * 0.6 + 0.2).toFixed(2));
                
                // --- Ambient Animations ---
                pJS.particles.opacity.anim.enable = Math.random() < 0.2;
                pJS.particles.size.anim.enable = Math.random() < 0.2;

                // --- Interactivity ---
                const isLinked = Math.random() < 0.3;
                pJS.particles.line_linked.enable = isLinked;
                pJS.interactivity.events.onhover.enable = true;
                if (isLinked) { pJS.interactivity.events.onhover.mode = 'grab'; } else { pJS.interactivity.events.onhover.mode = ['bubble', 'repulse'][Math.floor(Math.random() * 2)]; }
                
                pJS.fn.particlesRefresh();
            };

            particlesJS('particles-js', baseConfig);
            const pJS = window.pJSDom[0].pJS;
            generateRandomScene(pJS);

            const update = () => {
                for(const particle of pJS.particles.array) {
                    if (isMouseDown) {
                        const dx = mouse.x - particle.x; const dy = mouse.y - particle.y;
                        let forceX = 0; let forceY = 0;
                        forceX += dx * powerProfile.force * 0.05; forceY += dy * powerProfile.force * 0.05;
                        forceX -= dy * powerProfile.orbital; forceY += dx * powerProfile.orbital;
                        if (powerProfile.stableOrbitDist > 0) { const dist = Math.sqrt(dx*dx + dy*dy); const orbitForce = (dist - powerProfile.stableOrbitDist) * 0.001 * powerProfile.force; forceX -= dx * orbitForce; forceY -= dy * orbitForce; }
                        particle.vx += forceX; particle.vy += forceY;
                        if (powerProfile.creatorChance > 0 && Math.random() < powerProfile.creatorChance) { pJS.fn.modes.pushParticles(1, mouse); }
                    }
                    particle.vx *= friction; particle.vy *= friction;
                }
                pJS.fn.particlesDraw();
                requestAnimationFrame(update);
            };
            requestAnimationFrame(update);

            window.addEventListener('mousemove', e => {
                mouse.vx = e.clientX - mouse.x; mouse.vy = e.clientY - mouse.y;
                mouse.x = e.clientX; mouse.y = e.clientY;
                cursorGlow.style.left = `${e.clientX}px`; cursorGlow.style.top = `${e.clientY}px`;
            });

            window.addEventListener('mousedown', () => {
                isMouseDown = true;
                mouseDownTime = Date.now();
                pJS.interactivity.events.onhover.enable = false;
                setTimeout(() => {
                    if(isMouseDown) {
                        if (powerProfile.force < 0) { document.documentElement.style.setProperty('--glow-color', `rgba(255, 100, 100, ${Math.abs(powerProfile.force * 0.2)})`);
                        } else { document.documentElement.style.setProperty('--glow-color', `rgba(255, 255, 255, ${powerProfile.force * 0.2})`); }
                        cursorGlow.classList.add('active');
                        pJS.particles.move.speed = 0;
                    }
                }, 100);
            });

            window.addEventListener('mouseup', () => {
                const holdDuration = Date.now() - mouseDownTime;
                if (holdDuration < 200) {
                    pJS.fn.modes.pushParticles(4, mouse);
                } else {
                    pJS.particles.move.speed = initialSpeed;
                    if (powerProfile.force > 0.1) {
                        const mouseSpeed = Math.min(30, Math.sqrt(mouse.vx * mouse.vx + mouse.vy * mouse.vy));
                        for(const particle of pJS.particles.array) {
                            const angle = Math.random() * 2 * Math.PI;
                            const explosionSpeed = Math.random() * 20 + mouseSpeed;
                            particle.vx = (Math.cos(angle) * explosionSpeed) + (mouse.vx * 0.5);
                            particle.vy = (Math.sin(angle) * explosionSpeed) + (mouse.vy * 0.5);
                        }
                    }
                }
                isMouseDown = false;
                cursorGlow.classList.remove('active');
                pJS.interactivity.events.onhover.enable = true;
            });
        });
    </script>
</body>
</html>
