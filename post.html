<body>
    <iframe id="target" src="https://ndevtk.github.io/cross-site/"></iframe>
    <iframe id="checker" src="https://ndevtk.github.io/cross-site/"></iframe>
    <script>
      let target = document.getElementById('target');
      let checker = document.getElementById('checker');

      function worker_function() {
          self.onmessage = function (event) {
              for(let i=80000; i--;) opener.target.contentWindow.postMessage(value, '*');
          } 
      }

      const worker = new Worker(URL.createObjectURL(new Blob([`(${worker_function})()`], {type: "text/javascript"})));

      function time(value) {
        return new Promise(resolve => {
          checker.onload = () => {
            resolve(performance.now() - start);
          };
          let start = performance.now();
          worker.postMessage("");
          checker.contentWindow.location = "https://ndevtk.github.io/cross-site/";
        });
      }
    </script>
</body>
