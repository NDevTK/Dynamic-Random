<body>
    <iframe id="target" src="https://ndevtk.github.io/cross-site/"></iframe>
    <iframe id="checker" src="https://ndevtk.github.io/cross-site/"></iframe>
    <script>
      let target = document.getElementById('target');
      let checker = document.getElementById('checker');
      
        
      async function score(value, attempts = 80000, verify = 5) {
          let score = 0;
          for(let i=verify; i--;) {
              if (await check(value, attempts)) {
                  score += 1;
              } else {
                  score -= 1;
              }
          }
          return score;
      }
        
      async function check(value, attempts) {
        let time1 = await time('xx', attempts);
        let time2 = await time(value, attempts);
        console.log("time1: "+time1);
        console.log("time2: "+time2);
        return (time1 < time2);
      }

      function time(value, attempts) {
        for(let i=attempts; i--;) target.contentWindow.postMessage(value, '*');
        return new Promise(resolve => {
          checker.onload = () => {
            resolve(performance.now() - start);
          };
          let start = performance.now();
          checker.contentWindow.location = "https://ndevtk.github.io/cross-site/";
        });
      }
    </script>
</body>
